@using splsys.web.Models;
@{ ViewBag.Title = "Entidades";
	Layout = "~/Views/Shared/FixedSideBarMain.cshtml"; }
@section Header{

}

<div class="content">
	<div class="container-fluid">
		@Html.AntiForgeryToken()
		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<h5 class="card-title">Entidades</h5>
						<div class="card-tools">
							<a class="btn btn-success" href="@Url.Content("~/Entidades/Create")" title="Agregar Registro">
								<i class="far fa-file"></i> Agregar
							</a>
						</div>
					</div>
					<div class="card-body" style="overflow-y:auto;">
						<div class="divider">&nbsp;</div>
						<table id="tblDatos" class="table table-bordered table-hover">
							<thead>
								<tr>
									<th>Nombre</th>
									<th>RUC</th>
									<th>Email</th>
									<th style="width:90px" class="text-center all"></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
    $(function () {
        var datos = {
            __RequestVerificationToken : $('input[name=__RequestVerificationToken]').val()
        };
        $("#tblDatos").DataTable({
            "language": {
                url: '@Url.Content("~/Content/plugins/datatables/lang/Spanish.js")'
            },
            "responsive": true,
            "autoWidth": false,
            "stateSave": false,
            "processing": true,
            "serverSide": true,
            "destroy": true,
            "lengthMenu": [[100, 200, 300],[100, 200, 300]],
            columnDefs: [{
                orderable: false,
                targets: [3]
            }],
            "ajax": {
                "url": "@Url.Content("~/Entidades/ListarEntidades")",
                "type": "POST",
                "async": true,
                data :datos
            },
            "columns": [
                { "data": "nombre" },
                { "data": "ruc" },
				{ "data": "email" },
                { "data": "enlace" }
            ],
            "rowCallback": function (row, data, index) {
                $('td:eq(3)', row).html(
                    "<a class='btn btn-info btn-sm'  href='@Url.Content("~/Entidades/Edit")/" + data.id + "' style = 'color: #000 !important' title='Editar registro'><i class='fas fa-pencil-alt'></i></a>" +
                    "  <buttom class='btn btn-danger btn-sm' id='btnBorrar_" + data.Id  + "'  onclick='javascript:borrar(" + data.id + ")' style = 'color: #000 !important' title = 'Eliminar registro'><i class='fa fa-trash'></i></buttom>"
                );
            }

        });
    });

    function borrar(id) {
        bootbox.confirm({
        message: "¿Está seguro que desea eliminar la Entidad?",
        backdrop: false,
        centerVertical: true,
        buttons: {
            confirm: {
                label: 'Sí',
                className: 'btn-success'
            },
            cancel: {
                label: 'No',
                className: 'btn-danger'
            }
        },
            callback: function (result) {
                if (result == true) {
                     axios.get("@Url.Content("~/Entidades/Delete?id=")" + id).then(function (res) {
                           refrescarTabla("tblDatos");
                           notificaciones.mensajeAjax(res.data, "Borrar la entidad");
                    })
                    .catch(function (err) {
                         notificaciones.error(err.message, "Borrar la entidad", null);
                    });
             }
        }
    });
}
</script>
